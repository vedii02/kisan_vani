import os
from openai import OpenAI
from fastapi import HTTPException

# Initialize Groq client (uses OpenAI-compatible API)
groq_client = OpenAI(
    api_key=os.getenv("GROQ_API_KEY"),
    base_url="https://api.groq.com/openai/v1"
)

# Multi-language System Prompts for KisanAI
SYSTEM_PROMPTS = {
    'hi-IN': """‡§§‡•Å‡§Æ KisanAI ‡§π‡•ã - ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§ï‡•É‡§∑‡§ø ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û‡•§ 
‡§∏‡§∞‡§≤ ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç 2-3 ‡§µ‡§æ‡§ï‡•ç‡§Ø ‡§ú‡§µ‡§æ‡§¨ ‡§¶‡•ã‡•§ ‡§ï‡•á‡§µ‡§≤ ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§ú‡§µ‡§æ‡§¨ ‡§¶‡•ã‡•§

‡§ï‡•É‡§∑‡§ø ‡§ú‡•ç‡§û‡§æ‡§®: ‡§´‡§∏‡§≤‡•á‡§Ç (‡§ó‡•á‡§π‡•Ç‡§Ç, ‡§ß‡§æ‡§®, ‡§∏‡•ã‡§Ø‡§æ‡§¨‡•Ä‡§®), ‡§ï‡•Ä‡§ü‡§®‡§æ‡§∂‡§ï (‡§ï‡•ç‡§µ‡•Ä‡§®‡§æ‡§≤‡§´‡•ã‡§∏, ‡§ï‡§æ‡§∞‡•ç‡§¨‡•á‡§®‡•ç‡§°‡§æ‡§ú‡§ø‡§Æ), ‡§ñ‡§æ‡§¶ (‡§Ø‡•Ç‡§∞‡§ø‡§Ø‡§æ, ‡§°‡•Ä‡§è‡§™‡•Ä), ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç (PM-KISAN)

‡§π‡§Æ‡•á‡§∂‡§æ ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï ‡§î‡§∞ ‡§∏‡§ü‡•Ä‡§ï ‡§∏‡§≤‡§æ‡§π ‡§¶‡•ã‡•§""",

    'en-US': """You are KisanAI - agricultural expert for Indian farmers.
Give 2-3 sentence answers in SIMPLE ENGLISH ONLY.

Agriculture Knowledge: Crops (Wheat, Rice, Soybean), Pesticides (Quinalphos, Carbendazim), Fertilizers (Urea, DAP), Schemes (PM-KISAN)

Always be practical and accurate.""",

    'mr-IN': """‡§§‡•Ç KisanAI ‡§Ü‡§π‡•á‡§∏ - ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§∂‡•á‡§§‡§ï‡§±‡•ç‡§Ø‡§æ‡§Ç‡§∏‡§æ‡§†‡•Ä ‡§Æ‡§∞‡§æ‡§†‡•Ä ‡§ï‡•É‡§∑‡•Ä ‡§§‡§ú‡•ç‡§û‡•§
‡§∏‡•ã‡§™‡•ç‡§Ø‡§æ ‡§Æ‡§∞‡§æ‡§†‡•Ä‡§§ 2-3 ‡§µ‡§æ‡§ï‡•ç‡§Ø‡§æ‡§Ç‡§§ ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡•§ ‡§´‡§ï‡•ç‡§§ ‡§Æ‡§∞‡§æ‡§†‡•Ä‡§§ ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡•§

‡§ï‡•É‡§∑‡•Ä ‡§ú‡•ç‡§û‡§æ‡§®: ‡§™‡§ø‡§ï‡•á (‡§ó‡§π‡•Ç, ‡§§‡§æ‡§Ç‡§¶‡•Ç‡§≥, ‡§∏‡•ã‡§Ø‡§æ‡§¨‡•Ä‡§®), ‡§ï‡§ø‡§ü‡§ï‡§®‡§æ‡§∂‡§ï, ‡§ñ‡§§, ‡§Ø‡•ã‡§ú‡§®‡§æ

‡§®‡•á‡§π‡§Æ‡•Ä ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï ‡§∏‡§≤‡•ç‡§≤‡§æ ‡§¶‡•á‡•§""",

    'gu-IN': """‡™§‡´Å‡™Ç KisanAI ‡™õ‡´á - ‡™≠‡™æ‡™∞‡™§‡´Ä‡™Ø ‡™ñ‡´á‡™°‡´Ç‡™§‡´ã ‡™Æ‡™æ‡™ü‡´á ‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä ‡™ï‡´É‡™∑‡™ø ‡™®‡™ø‡™∑‡´ç‡™£‡™æ‡™§.
‡™∏‡™∞‡™≥ ‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä‡™Æ‡™æ‡™Ç 2-3 ‡™µ‡™æ‡™ï‡´ç‡™Ø‡´ã‡™Æ‡™æ‡™Ç ‡™ú‡™µ‡™æ‡™¨ ‡™Ü‡™™. ‡™´‡™ï‡´ç‡™§ ‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä‡™Æ‡™æ‡™Ç ‡™ú‡™µ‡™æ‡™¨ ‡™Ü‡™™.

‡™ï‡´É‡™∑‡™ø ‡™ú‡´ç‡™û‡™æ‡™®: ‡™™‡™æ‡™ï‡´ã (‡™ò‡™â‡™Ç, ‡™ö‡´ã‡™ñ‡™æ, ‡™∏‡´ã‡™Ø‡™æ‡™¨‡´Ä‡™®), ‡™ú‡´Ä‡™µ‡™æ‡™§‡™®‡™æ‡™∂‡™ï, ‡™ñ‡™æ‡™§‡™∞, ‡™Ø‡´ã‡™ú‡™®‡™æ‡™ì

‡™π‡™Ç‡™Æ‡´á‡™∂‡™æ ‡™µ‡´ç‡™Ø‡™µ‡™π‡™æ‡™∞‡´Å ‡™∏‡™≤‡™æ‡™π ‡™Ü‡™™.""",

    'bn-IN': """‡¶§‡ßÅ‡¶Æ‡¶ø KisanAI - ‡¶≠‡¶æ‡¶∞‡¶§‡ßÄ‡¶Ø‡¶º ‡¶ï‡ßÉ‡¶∑‡¶ï‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑‡¶ú‡ßç‡¶û‡•§
‡¶∏‡¶π‡¶ú ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶Ø‡¶º ‡ß®-‡ß© ‡¶¨‡¶æ‡¶ï‡ßç‡¶Ø‡ßá ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡¶æ‡¶ì‡•§ ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶Ø‡¶º ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡¶æ‡¶ì‡•§

‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶ú‡ßç‡¶û‡¶æ‡¶®: ‡¶´‡¶∏‡¶≤ (‡¶ó‡¶Æ, ‡¶ß‡¶æ‡¶®, ‡¶∏‡¶Ø‡¶º‡¶æ‡¶¨‡¶ø‡¶®), ‡¶ï‡ßÄ‡¶ü‡¶®‡¶æ‡¶∂‡¶ï, ‡¶∏‡¶æ‡¶∞, ‡¶™‡ßç‡¶∞‡¶ï‡¶≤‡ßç‡¶™

‡¶∏‡¶¨‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ø‡¶ï ‡¶™‡¶∞‡¶æ‡¶Æ‡¶∞‡ßç‡¶∂ ‡¶¶‡¶æ‡¶ì‡•§""",

    'te-IN': """‡∞®‡±Å‡∞µ‡±ç‡∞µ‡±Å KisanAI - ‡∞≠‡∞æ‡∞∞‡∞§‡±Ä‡∞Ø ‡∞∞‡±à‡∞§‡±Å‡∞≤ ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å ‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø ‡∞®‡∞ø‡∞™‡±Å‡∞£‡±Å‡∞°‡±Å.
‡∞∏‡∞∞‡∞≥‡∞Æ‡±à‡∞® ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å‡∞≤‡±ã 2-3 ‡∞µ‡∞æ‡∞ï‡±ç‡∞Ø‡∞æ‡∞≤‡∞≤‡±ã ‡∞∏‡∞Æ‡∞æ‡∞ß‡∞æ‡∞®‡∞Ç ‡∞á‡∞µ‡±ç‡∞µ‡±Å. ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å‡∞≤‡±ã ‡∞Æ‡∞æ‡∞§‡±ç‡∞∞‡∞Æ‡±á ‡∞∏‡∞Æ‡∞æ‡∞ß‡∞æ‡∞®‡∞Ç ‡∞á‡∞µ‡±ç‡∞µ‡±Å.

‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø ‡∞ú‡±ç‡∞û‡∞æ‡∞®‡∞Ç: ‡∞™‡∞Ç‡∞ü‡∞≤‡±Å (‡∞ó‡±ã‡∞ß‡±Å‡∞Æ‡∞≤‡±Å, ‡∞µ‡∞∞‡∞ø, ‡∞∏‡±ã‡∞Ø‡∞æ‡∞¨‡±Ä‡∞®‡±ç), ‡∞™‡±Å‡∞∞‡±Å‡∞ó‡±Å‡∞Æ‡∞Ç‡∞¶‡±Å‡∞≤‡±Å, ‡∞é‡∞∞‡±Å‡∞µ‡±Å‡∞≤‡±Å, ‡∞™‡∞•‡∞ï‡∞æ‡∞≤‡±Å

‡∞é‡∞≤‡±ç‡∞≤‡∞™‡±ç‡∞™‡±Å‡∞°‡±Ç ‡∞Ü‡∞ö‡∞∞‡∞£‡∞æ‡∞§‡±ç‡∞Æ‡∞ï ‡∞∏‡∞≤‡∞π‡∞æ ‡∞á‡∞µ‡±ç‡∞µ‡±Å.""",

    'ta-IN': """‡Æ®‡ØÄ KisanAI - ‡Æá‡Æ®‡Øç‡Æ§‡Æø‡ÆØ ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æø‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æ© ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç ‡Æµ‡Øá‡Æ≥‡Ææ‡Æ£‡Øç ‡Æ®‡Æø‡Æ™‡ØÅ‡Æ£‡Æ∞‡Øç.
‡Æé‡Æ≥‡Æø‡ÆØ ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Æø‡Æ≤‡Øç 2-3 ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡Æø‡ÆØ‡Æô‡Øç‡Æï‡Æ≥‡Æø‡Æ≤‡Øç ‡Æ™‡Æ§‡Æø‡Æ≤‡Øç ‡Æö‡Øä‡Æ≤‡Øç. ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Æø‡Æ≤‡Øç ‡ÆÆ‡Æü‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Æ§‡Æø‡Æ≤‡Øç ‡Æö‡Øä‡Æ≤‡Øç.

‡Æµ‡Øá‡Æ≥‡Ææ‡Æ£‡Øç ‡ÆÖ‡Æ±‡Æø‡Æµ‡ØÅ: ‡Æ™‡ÆØ‡Æø‡Æ∞‡Øç‡Æï‡Æ≥‡Øç (‡Æï‡Øã‡Æ§‡ØÅ‡ÆÆ‡Øà, ‡ÆÖ‡Æ∞‡Æø‡Æö‡Æø, ‡Æö‡Øã‡ÆØ‡Ææ‡Æ™‡ØÄ‡Æ©‡Øç), ‡Æ™‡ØÇ‡Æö‡Øç‡Æö‡Æø‡Æï‡Øç‡Æï‡Øä‡Æ≤‡Øç‡Æ≤‡Æø, ‡Æâ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øç, ‡Æ§‡Æø‡Æü‡Øç‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Øç

‡Æé‡Æ™‡Øç‡Æ™‡Øã‡Æ§‡ØÅ‡ÆÆ‡Øç ‡Æ®‡Æü‡Øà‡ÆÆ‡ØÅ‡Æ±‡Øà ‡ÆÜ‡Æ≤‡Øã‡Æö‡Æ©‡Øà ‡Æï‡Øä‡Æü‡ØÅ.""",

    'kn-IN': """‡≤®‡≥Ä‡≤®‡≥Å KisanAI - ‡≤≠‡≤æ‡≤∞‡≤§‡≥Ä‡≤Ø ‡≤∞‡≥à‡≤§‡≤∞‡≤ø‡≤ó‡≥Ü ‡≤ï‡≤®‡≥ç‡≤®‡≤° ‡≤ï‡≥É‡≤∑‡≤ø ‡≤§‡≤ú‡≥ç‡≤û.
‡≤∏‡≤∞‡≤≥ ‡≤ï‡≤®‡≥ç‡≤®‡≤°‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø 2-3 ‡≤µ‡≤æ‡≤ï‡≥ç‡≤Ø‡≤ó‡≤≥‡≤≤‡≥ç‡≤≤‡≤ø ‡≤â‡≤§‡≥ç‡≤§‡≤∞‡≤ø‡≤∏‡≥Å. ‡≤ï‡≤®‡≥ç‡≤®‡≤°‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤Æ‡≤æ‡≤§‡≥ç‡≤∞ ‡≤â‡≤§‡≥ç‡≤§‡≤∞‡≤ø‡≤∏‡≥Å.

‡≤ï‡≥É‡≤∑‡≤ø ‡≤ú‡≥ç‡≤û‡≤æ‡≤®: ‡≤¨‡≥Ü‡≤≥‡≥Ü‡≤ó‡≤≥‡≥Å (‡≤ó‡≥ã‡≤ß‡≤ø, ‡≤Ö‡≤ï‡≥ç‡≤ï‡≤ø, ‡≤∏‡≥ã‡≤Ø‡≤æ‡≤¨‡≥Ä‡≤®‡≥ç), ‡≤ï‡≥Ä‡≤ü‡≤®‡≤æ‡≤∂‡≤ï‡≤ó‡≤≥‡≥Å, ‡≤ó‡≥ä‡≤¨‡≥ç‡≤¨‡≤∞‡≤ó‡≤≥‡≥Å, ‡≤Ø‡≥ã‡≤ú‡≤®‡≥Ü‡≤ó‡≤≥‡≥Å

‡≤Ø‡≤æ‡≤µ‡≤æ‡≤ó‡≤≤‡≥Ç ‡≤™‡≥ç‡≤∞‡≤æ‡≤Ø‡≥ã‡≤ó‡≤ø‡≤ï ‡≤∏‡≤≤‡≤π‡≥Ü ‡≤ï‡≥ä‡≤°‡≥Å.""",

    'ml-IN': """‡¥®‡µÄ KisanAI - ‡¥á‡¥®‡µç‡¥§‡µç‡¥Ø‡µª ‡¥ï‡µº‡¥∑‡¥ï‡µº‡¥ï‡µç‡¥ï‡µÅ‡¥≥‡µç‡¥≥ ‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç ‡¥ï‡¥æ‡µº‡¥∑‡¥ø‡¥ï ‡¥µ‡¥ø‡¥¶‡¥ó‡µç‡¥ß‡µª.
‡¥≤‡¥≥‡¥ø‡¥§‡¥Æ‡¥æ‡¥Ø ‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥§‡µç‡¥§‡¥ø‡µΩ 2-3 ‡¥µ‡¥æ‡¥ï‡µç‡¥Ø‡¥ô‡µç‡¥ô‡¥≥‡¥ø‡µΩ ‡¥â‡¥§‡µç‡¥§‡¥∞‡¥Ç ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï. ‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥§‡µç‡¥§‡¥ø‡µΩ ‡¥Æ‡¥æ‡¥§‡µç‡¥∞‡¥Ç ‡¥â‡¥§‡µç‡¥§‡¥∞‡¥Ç ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï.

‡¥ï‡¥æ‡µº‡¥∑‡¥ø‡¥ï ‡¥Ö‡¥±‡¥ø‡¥µ‡µç: ‡¥µ‡¥ø‡¥≥‡¥ï‡µæ (‡¥ó‡µã‡¥§‡¥Æ‡µç‡¥™‡µç, ‡¥Ö‡¥∞‡¥ø, ‡¥∏‡µã‡¥Ø‡¥æ‡¥¨‡µÄ‡µª), ‡¥ï‡µÄ‡¥ü‡¥®‡¥æ‡¥∂‡¥ø‡¥®‡¥ø‡¥ï‡µæ, ‡¥µ‡¥≥‡¥ô‡µç‡¥ô‡µæ, ‡¥™‡¥¶‡µç‡¥ß‡¥§‡¥ø‡¥ï‡µæ

‡¥é‡¥™‡µç‡¥™‡µã‡¥¥‡µÅ‡¥Ç ‡¥™‡µç‡¥∞‡¥æ‡¥Ø‡µã‡¥ó‡¥ø‡¥ï ‡¥â‡¥™‡¥¶‡µá‡¥∂‡¥Ç ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï.""",

    'pa-IN': """‡®§‡©Ç‡©∞ KisanAI ‡®π‡©à‡®Ç - ‡®≠‡®æ‡®∞‡®§‡©Ä ‡®ï‡®ø‡®∏‡®æ‡®®‡®æ‡®Ç ‡®≤‡®à ‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä ‡®ñ‡©á‡®§‡©Ä‡®¨‡®æ‡©ú‡©Ä ‡®Æ‡®æ‡®π‡®ø‡®∞‡•§
‡®∏‡®∞‡®≤ ‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä ‡®µ‡®ø‡©±‡®ö 2-3 ‡®µ‡®æ‡®ï‡®æ‡®Ç ‡®µ‡®ø‡©±‡®ö ‡®ú‡®µ‡®æ‡®¨ ‡®¶‡©á‡•§ ‡®∏‡®ø‡®∞‡®´‡®º ‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä ‡®µ‡®ø‡©±‡®ö ‡®ú‡®µ‡®æ‡®¨ ‡®¶‡©á‡•§

‡®ñ‡©á‡®§‡©Ä‡®¨‡®æ‡©ú‡©Ä ‡®ó‡®ø‡®Ü‡®®: ‡®´‡®∏‡®≤‡®æ‡®Ç (‡®ï‡®£‡®ï, ‡®ö‡©å‡®≤, ‡®∏‡©ã‡®á‡®Ü‡®¨‡©Ä‡®®), ‡®ï‡©Ä‡©ú‡©á‡®Æ‡®æ‡®∞, ‡®ñ‡®æ‡®¶, ‡®Ø‡©ã‡®ú‡®®‡®æ‡®µ‡®æ‡®Ç

‡®π‡®Æ‡©á‡®∏‡®º‡®æ‡®Ç ‡®µ‡®ø‡®π‡®æ‡®∞‡®ï ‡®∏‡®≤‡®æ‡®π ‡®¶‡©á‡•§"""
}


async def kisan_chat(message: str, language: str) -> str:
    """
    Get AI response for farmer's query using Groq API
    """
    
    # Check if API key exists
    api_key = os.getenv("GROQ_API_KEY")
    if not api_key:
        print("‚ùå GROQ_API_KEY not found in environment!")
        print("Please add GROQ_API_KEY to your .env file")
        raise HTTPException(
            status_code=500,
            detail="GROQ_API_KEY not configured. Get it from https://console.groq.com"
        )
    
    print(f"üîë Groq API Key found: {api_key[:20]}...")
    
    # Get appropriate system prompt
    system_prompt = SYSTEM_PROMPTS.get(language, SYSTEM_PROMPTS['en-US'])
    
    # Language names
    language_names = {
        'hi-IN': 'Hindi', 'en-US': 'English', 'mr-IN': 'Marathi',
        'gu-IN': 'Gujarati', 'bn-IN': 'Bengali', 'te-IN': 'Telugu',
        'ta-IN': 'Tamil', 'kn-IN': 'Kannada', 'ml-IN': 'Malayalam', 'pa-IN': 'Punjabi'
    }
    language_name = language_names.get(language, 'English')
    
    try:
        print(f"ü§ñ Calling Groq API...")
        print(f"   Model: llama-3.3-70b-versatile")
        print(f"   Message: {message[:50]}...")
        print(f"   Language: {language_name}")
        
        # Call Groq API
        completion = groq_client.chat.completions.create(
            model="llama-3.3-70b-versatile",  # Fast and good model
            messages=[
                {
                    "role": "system",
                    "content": f"{system_prompt}\n\nIMPORTANT: Reply ONLY in {language_name}. Keep answer to 2-3 sentences maximum."
                },
                {
                    "role": "user",
                    "content": message
                }
            ],
            max_tokens=200,
            temperature=0.5,
            top_p=1,
            stream=False
        )
        
        response = completion.choices[0].message.content.strip()
        
        # Validate response
        if not response or len(response) < 5:
            print("‚ö†Ô∏è Empty or too short response from Groq")
            raise Exception("Groq returned empty response")
        
        print(f"‚úÖ Groq Success: {response[:100]}...")
        
        return response
    
    except Exception as e:
        print("=" * 60)
        print("‚ùå GROQ API ERROR!")
        print("=" * 60)
        print(f"Error type: {type(e).__name__}")
        print(f"Error message: {str(e)}")
        print(f"API Key (first 20 chars): {api_key[:20] if api_key else 'NONE'}...")
        print("=" * 60)
        
        # Try to get more error details
        if hasattr(e, 'response'):
            print(f"Response status: {e.response.status_code if hasattr(e.response, 'status_code') else 'N/A'}")
            print(f"Response body: {e.response.text if hasattr(e.response, 'text') else 'N/A'}")
        
        # Check for specific errors
        error_str = str(e).lower()
        if "authentication" in error_str or "api key" in error_str:
            print("üîë Issue: Invalid or missing Groq API key")
            print("üí° Get key from: https://console.groq.com/keys")
        elif "rate limit" in error_str or "quota" in error_str:
            print("‚ö†Ô∏è Issue: Rate limit exceeded or quota finished")
        elif "model" in error_str:
            print("‚ö†Ô∏è Issue: Model not available")
        
        print("=" * 60)
        
        # Fallback responses
        fallback = {
            'hi-IN': "‡§Æ‡§æ‡§´‡§º ‡§ï‡§∞‡•á‡§Ç, ‡§Ö‡§≠‡•Ä ‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§•‡•ã‡§°‡§º‡•Ä ‡§¶‡•á‡§∞ ‡§¨‡§æ‡§¶ ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç‡•§",
            'en-US': "Sorry, technical issue. Please try again in a moment.",
            'mr-IN': "‡§Æ‡§æ‡§´ ‡§ï‡§∞‡§æ, ‡§§‡§æ‡§Ç‡§§‡•ç‡§∞‡§ø‡§ï ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ü‡§π‡•á‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§•‡•ã‡§°‡•ç‡§Ø‡§æ ‡§µ‡•á‡§≥‡§æ‡§®‡•á ‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§æ‡•§",
            'gu-IN': "‡™Æ‡™æ‡™´ ‡™ï‡™∞‡™∂‡´ã, ‡™§‡™ï‡™®‡´Ä‡™ï‡´Ä ‡™∏‡™Æ‡™∏‡´ç‡™Ø‡™æ ‡™õ‡´á‡•§ ‡™•‡´ã‡™°‡´Ä ‡™µ‡™æ‡™∞ ‡™™‡™õ‡´Ä ‡™´‡™∞‡´Ä ‡™™‡´ç‡™∞‡™Ø‡™æ‡™∏ ‡™ï‡™∞‡´ã.",
            'bn-IN': "‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶™‡ßç‡¶∞‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡•§ ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶™‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§",
            'te-IN': "‡∞ï‡±ç‡∞∑‡∞Æ‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø, ‡∞∏‡∞æ‡∞Ç‡∞ï‡±á‡∞§‡∞ø‡∞ï ‡∞∏‡∞Æ‡∞∏‡±ç‡∞Ø. ‡∞ï‡±ä‡∞Ç‡∞ö‡±Ü‡∞Ç ‡∞§‡∞∞‡±ç‡∞µ‡∞æ‡∞§ ‡∞Æ‡∞≥‡±ç‡∞≤‡±Ä ‡∞™‡±ç‡∞∞‡∞Ø‡∞§‡±ç‡∞®‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
            'ta-IN': "‡ÆÆ‡Æ©‡Øç‡Æ©‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç, ‡Æ§‡Øä‡Æ¥‡Æø‡Æ≤‡Øç‡Æ®‡ØÅ‡Æü‡Øç‡Æ™ ‡Æö‡Æø‡Æï‡Øç‡Æï‡Æ≤‡Øç. ‡Æö‡Æø‡Æ±‡Æø‡Æ§‡ØÅ ‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç ‡Æï‡Æ¥‡Æø‡Æ§‡Øç‡Æ§‡ØÅ ‡ÆÆ‡ØÅ‡ÆØ‡Æ±‡Øç‡Æö‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.",
            'kn-IN': "‡≤ï‡≥ç‡≤∑‡≤Æ‡≤ø‡≤∏‡≤ø, ‡≤§‡≤æ‡≤Ç‡≤§‡≥ç‡≤∞‡≤ø‡≤ï ‡≤∏‡≤Æ‡≤∏‡≥ç‡≤Ø‡≥Ü. ‡≤∏‡≥ç‡≤µ‡≤≤‡≥ç‡≤™ ‡≤∏‡≤Æ‡≤Ø‡≤¶ ‡≤®‡≤Ç‡≤§‡≤∞ ‡≤™‡≥ç‡≤∞‡≤Ø‡≤§‡≥ç‡≤®‡≤ø‡≤∏‡≤ø.",
            'ml-IN': "‡¥ï‡µç‡¥∑‡¥Æ‡¥ø‡¥ï‡µç‡¥ï‡¥£‡¥Ç, ‡¥∏‡¥æ‡¥ô‡µç‡¥ï‡µá‡¥§‡¥ø‡¥ï ‡¥™‡µç‡¥∞‡¥∂‡µç‡¥®‡¥Ç. ‡¥ï‡µÅ‡¥±‡¥ö‡µç‡¥ö‡µç ‡¥∏‡¥Æ‡¥Ø‡¥§‡µç‡¥§‡¥ø‡¥®‡µç ‡¥∂‡µá‡¥∑‡¥Ç ‡¥µ‡µÄ‡¥£‡µç‡¥ü‡µÅ‡¥Ç ‡¥∂‡µç‡¥∞‡¥Æ‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.",
            'pa-IN': "‡®Æ‡®æ‡®´‡®º ‡®ï‡®∞‡©ã, ‡®§‡®ï‡®®‡©Ä‡®ï‡©Ä ‡®∏‡®Æ‡©±‡®∏‡®ø‡®Ü‡•§ ‡®•‡©ã‡©ú‡©Ä ‡®¶‡©á‡®∞ ‡®¨‡®æ‡®Ö‡®¶ ‡®¶‡©Å‡®¨‡®æ‡®∞‡®æ ‡®ï‡©ã‡®∏‡®º‡®ø‡®∏‡®º ‡®ï‡®∞‡©ã‡•§"
        }
        
        return fallback.get(language, fallback['en-US'])